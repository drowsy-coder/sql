-- Task 1: Create the Student table
CREATE TABLE Student (
    name VARCHAR2(100),
    regno VARCHAR2(20),
    dept VARCHAR2(50),
    year NUMBER,
    Mark1 NUMBER,
    Mark2 NUMBER,
    Mark3 NUMBER,
    Total NUMBER,
    Average NUMBER
);

-- Task 2: Write a PL/SQL Procedure using implicit cursor attributes
CREATE OR REPLACE PROCEDURE StudentOperations AS
BEGIN
    -- a. Select students those are belongs to ECE department
    FOR rec IN (SELECT * FROM Student WHERE dept = 'ECE') LOOP
        DBMS_OUTPUT.PUT_LINE('Student: ' || rec.name || ', RegNo: ' || rec.regno);
    END LOOP;

    -- b. Insert records with name, regno, dept, year, Mark1, Mark2, Mark3
    INSERT INTO Student (name, regno, dept, year, Mark1, Mark2, Mark3)
    VALUES ('John Doe', 'REG123', 'ECE', 3, 85, 90, 88);

    -- c. Select students those are belongs to CSE department
    FOR rec IN (SELECT * FROM Student WHERE dept = 'CSE') LOOP
        DBMS_OUTPUT.PUT_LINE('Student: ' || rec.name || ', RegNo: ' || rec.regno);
    END LOOP;

    -- d. Update total and average
    UPDATE Student SET
        Total = Mark1 + Mark2 + Mark3,
        Average = (Mark1 + Mark2 + Mark3) / 3
    WHERE dept = 'CSE';

    -- e. Delete students belongs to ECE department
    DELETE FROM Student WHERE dept = 'ECE';

    COMMIT;
END;
/

-- Task 3: Write a PL/SQL Procedure using Explicit cursor
CREATE OR REPLACE PROCEDURE DisplayStudentRecords AS
    CURSOR student_cursor IS
        SELECT * FROM Student;
    CURSOR top_students_cursor IS
        SELECT * FROM Student WHERE Average > 90;
BEGIN
    -- a. Display all the records using cursor
    DBMS_OUTPUT.PUT_LINE('All Students:');
    FOR rec IN student_cursor LOOP
        DBMS_OUTPUT.PUT_LINE('Name: ' || rec.name || ', Dept: ' || rec.dept || ', Average: ' || rec.Average);
    END LOOP;

    -- b. Display the students those who are having average greater than 90
    DBMS_OUTPUT.PUT_LINE('Top Students:');
    FOR rec IN top_students_cursor LOOP
        DBMS_OUTPUT.PUT_LINE('Name: ' || rec.name || ', Dept: ' || rec.dept || ', Average: ' || rec.Average);
    END LOOP;
END;
/
